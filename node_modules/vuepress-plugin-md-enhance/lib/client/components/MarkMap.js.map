{"version":3,"file":"MarkMap.js","sources":["../../../src/client/components/MarkMap.ts"],"sourcesContent":["import { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Markmap } from \"markmap-view\";\nimport type { VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport \"../styles/markmap.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nexport default defineComponent({\n  name: \"MarkMap\",\n\n  props: {\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Markmap content\n     *\n     * Markmap\n     */\n    content: { type: String, required: true },\n  },\n\n  setup(props) {\n    const loading = ref(true);\n    const markupWrapper = shallowRef<HTMLElement>();\n    const markmapSvg = shallowRef<SVGElement>();\n\n    let markupMap: Markmap | null = null;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        void markupMap?.fit();\n      }, 100),\n    );\n\n    onMounted(() => {\n      void Promise.all([\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-lib\"),\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-toolbar\"),\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-view\"),\n        // delay\n        new Promise((resolve) => setTimeout(resolve, MARKDOWN_ENHANCE_DELAY)),\n      ]).then(async ([{ Transformer }, { Toolbar }, { Markmap }]) => {\n        const transformer = new Transformer();\n        const { root } = transformer.transform(atou(props.content));\n\n        markupMap = Markmap.create(markmapSvg.value!);\n\n        const { el } = Toolbar.create(markupMap);\n\n        markupMap.setData(root);\n        await markupMap.fit();\n\n        el.style.position = \"absolute\";\n        el.style.bottom = \"0.5rem\";\n        el.style.right = \"0.5rem\";\n\n        markupWrapper.value!.append(el);\n        loading.value = false;\n      });\n    });\n\n    onUnmounted(() => {\n      markupMap?.destroy();\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"markmap-wrapper\", ref: markupWrapper }, [\n        h(\"svg\", {\n          ref: markmapSvg,\n          class: \"markmap-svg\",\n          id: props.id,\n        }),\n        loading.value\n          ? h(LoadingIcon, { class: \"markmap-loading\", height: 360 })\n          : null,\n      ]);\n  },\n});\n"],"names":["MarkMap","defineComponent","props","loading","ref","markupWrapper","shallowRef","markmapSvg","markupMap","useEventListener","useDebounceFn","onMounted","resolve","Transformer","Toolbar","Markmap","transformer","root","atou","el","onUnmounted","h","LoadingIcon"],"mappings":"uQAiBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,QAAS,CAAE,KAAM,OAAQ,SAAU,EAAK,CAC1C,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAUC,EAAI,EAAI,EAClBC,EAAgBC,EAAAA,EAChBC,EAAaD,EAAuB,EAE1C,IAAIE,EAA4B,KAEhC,OAAAC,EACE,SACAC,EAAc,IAAM,CACbF,GAAW,IAAI,CACtB,EAAG,GAAG,CACR,EAEAG,EAAU,IAAM,CACT,QAAQ,IAAI,CACf,OAAyC,aAAa,EACtD,OAAyC,iBAAiB,EAC1D,OAAyC,cAAc,EAEvD,IAAI,QAASC,GAAY,WAAWA,EAAS,sBAAsB,CAAC,CACtE,CAAC,EAAE,KAAK,MAAO,CAAC,CAAE,YAAAC,CAAY,EAAG,CAAE,QAAAC,CAAQ,EAAG,CAAE,QAAAC,CAAQ,CAAC,IAAM,CAC7D,MAAMC,EAAc,IAAIH,EAClB,CAAE,KAAAI,CAAK,EAAID,EAAY,UAAUE,EAAKhB,EAAM,OAAO,CAAC,EAE1DM,EAAYO,EAAQ,OAAOR,EAAW,KAAM,EAE5C,KAAM,CAAE,GAAAY,CAAG,EAAIL,EAAQ,OAAON,CAAS,EAEvCA,EAAU,QAAQS,CAAI,EACtB,MAAMT,EAAU,IAEhBW,EAAAA,EAAG,MAAM,SAAW,WACpBA,EAAG,MAAM,OAAS,SAClBA,EAAG,MAAM,MAAQ,SAEjBd,EAAc,MAAO,OAAOc,CAAE,EAC9BhB,EAAQ,MAAQ,EAClB,CAAC,CACH,CAAC,EAEDiB,EAAY,IAAM,CAChBZ,GAAW,QACb,CAAA,CAAC,EAEM,IACLa,EAAE,MAAO,CAAE,MAAO,kBAAmB,IAAKhB,CAAc,EAAG,CACzDgB,EAAE,MAAO,CACP,IAAKd,EACL,MAAO,cACP,GAAIL,EAAM,EACZ,CAAC,EACDC,EAAQ,MACJkB,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EACxD,IACN,CAAC,CACL,CACF,CAAC"}